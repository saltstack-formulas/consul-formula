consul:
  service: true

  config:
    server: true
    bind_addr: 0.0.0.0

    enable_debug: true

    datacenter: eu

    encrypt: "RIxqpNlOXqtr/j4BgvIMEw=="

    bootstrap_expect: 3
    retry_interval: 15s
    retry_join:
      - 1.1.1.1
      - 2.2.2.2

  register:
    - name: Redis
      checks:
        - script: /usr/local/share/consul/check_redis.py
          interval: 10s
  scripts:
    - source: salt://files/consul/check_redis.py 
      name: /usr/local/share/consul/check_redis.py

consul_template:
  service: true

consul_template:
  instances:
    default:
      example:
        config:
          template:
            - source: /etc/consul-template/default/tmpl-source/example.ctmpl
            - destination: /tmp/example
        tmpl:
          - |

    nginx:
      www.example.com:
        config:
          template:
            - command: systemctl restart nginx
              source: /etc/consul-template/nginx/tmpl-source/www.example.com.nginx.vhost.ctmpl
              destination: /etc/nginx/sites-available/www.example.com
        tmpl:
          - |
            {% raw %}
            server {
              listen 80;
              root /var/www/html/www.example.com;

              location / {
                try_files index.html;
              }
            }
            {% endraw %}
